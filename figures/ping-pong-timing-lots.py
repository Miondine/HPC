import argparse

import numpy
from matplotlib import pyplot

parser = argparse.ArgumentParser()
parser.add_argument("output", type=str)

args, _ = parser.parse_known_args()

ham6one = numpy.loadtxt(r"""
1 422375 4.89877e-07
2 627834 4.74586e-07
4 679454 4.62567e-07
8 966776 4.20815e-07
16 938564 4.10685e-07
32 556442 4.94737e-07
64 638701 4.82662e-07
128 596684 5.71572e-07
256 578824 6.20523e-07
512 423496 7.89052e-07
1024 596486 7.93526e-07
2048 404217 1.08793e-06
4096 485558 1.27568e-06
8192 709438 1.65563e-06
16384 233120 2.93921e-06
32768 111145 6.09573e-06
65536 145071 9.10776e-06
131072 37972 1.88933e-05
262144 19848 3.89792e-05
524288 9119 8.17672e-05
1048576 2301 0.000487678
2097152 1243 0.000959081
4194304 636 0.00194771
8388608 390 0.003749
16777216 183 0.00745442
33554432 94 0.0149698
67108864 49 0.0300366
""".strip().splitlines())

ham6two = numpy.loadtxt(r"""
1 15264 5.99079e-06
2 17113 6.11105e-06
4 20325 5.61679e-06
8 16105 7.65405e-06
16 14508 6.08773e-06
32 14632 7.66526e-06
64 14709 5.91945e-06
128 15188 6.21689e-06
256 18849 5.8126e-06
512 16520 6.45811e-06
1024 15668 6.89663e-06
2048 13703 9.44968e-06
4096 17478 1.01898e-05
8192 16008 1.00256e-05
16384 14883 1.48427e-05
32768 10259 3.5773e-05
65536 13343 3.63655e-05
131072 7805 5.88605e-05
262144 437 0.00316124
524288 444 0.00317579
1048576 424 0.00322769
2097152 334 0.00410957
4194304 344 0.00413566
8388608 243 0.00607945
16777216 158 0.00907439
33554432 6 0.381735
67108864 51 0.0276811
""".strip().splitlines())

ham7one = numpy.loadtxt(r"""
1 560319 4.83926e-07
2 1004506 4.61742e-07
4 872667 4.63351e-07
8 866307 4.66618e-07
16 1247374 4.39138e-07
32 831801 4.8268e-07
64 1158851 4.67097e-07
128 806937 4.81646e-07
256 926096 5.79535e-07
512 554011 7.76776e-07
1024 698490 8.38381e-07
2048 518554 1.01111e-06
4096 572587 1.28711e-06
8192 334387 2.0067e-06
16384 262208 3.23649e-06
32768 140525 6.07447e-06
65536 81505 1.05492e-05
131072 48470 1.92604e-05
262144 22967 4.4565e-05
524288 11085 8.55361e-05
1048576 6369 0.000166949
2097152 3302 0.000321107
4194304 2115 0.000562784
8388608 1153 0.00110259
16777216 574 0.00215726
33554432 315 0.00420684
67108864 168 0.00823026
""".strip().splitlines())

ham7two = numpy.loadtxt(r"""
1 21940 4.60315e-06
2 17549 4.59897e-06
4 17303 4.67491e-06
8 17519 4.43693e-06
16 16173 4.66161e-06
32 15962 4.58382e-06
64 16787 4.65294e-06
128 17214 4.4695e-06
256 16179 4.96721e-06
512 15242 5.27568e-06
1024 15929 6.65241e-06
2048 15742 7.05671e-06
4096 14864 8.10632e-06
8192 13879 1.21818e-05
16384 13389 1.62001e-05
32768 12476 2.04128e-05
65536 10816 3.26766e-05
131072 10168 4.51817e-05
262144 419 0.00348114
524288 422 0.00349315
1048576 381 0.00380106
2097152 357 0.00402522
4194304 334 0.00456559
8388608 284 0.00502456
16777216 218 0.0060281
33554432 93 0.0146909
67108864 56 0.0257103
""".strip().splitlines())

fig, axes = pyplot.subplots(1)

axes.plot(ham6one[:, 0], ham6one[:, 2], "o-",
          label=r"Hamilton 6 (single node)")
axes.plot(ham6two[:, 0], ham6two[:, 2], "o-",
          label=r"Hamilton 6 (two nodes)")
axes.plot(ham7one[:, 0], ham7one[:, 2], "o-",
          label=r"Hamilton 7 (single node)")
axes.plot(ham7two[:, 0], ham7two[:, 2], "o-",
          label=r"Hamilton 7 (two nodes)")

axes.set_xscale('log', base=2)
axes.set_yscale('log', base=10)
axes.set_xlabel("Size of message in bytes")
axes.set_ylabel("Time to send message [s]")
axes.legend(loc="best")

fig.savefig(args.output,
            orientation="landscape",
            transparent=True,
            bbox_inches="tight")
